machine:
  php:
    version: 7.0.4
  environment:
    DBUS_SESSION_BUS_ADDRESS: /dev/null

dependencies:
  pre:
    - echo "memory_limit = 2048M" > /opt/circleci/php/$(phpenv global)/etc/conf.d/memory.ini
    - type -P yarn &> /dev/null || curl -o- -s -L https://yarnpkg.com/install.sh | bash
  override:
    - composer install --dev --no-interaction --no-progress
    - yarn --no-progress
  cache_directories:
    - "~/.composer/cache"
    - "~/.yarn-cache"

test:
  override:
    - cp .env.example .env
    - php artisan key:generate
    - yarn run test:dusk
    - yarn run test:phpunit
